// Variables globales
        let conversationHistory = [];
        let isTyping = false;
        let currentContext = '';

        // Base de datos mejorada de soluciones
        const solutions = {
            'no-enciende': {
                title: 'üîå Computador no enciende',
                steps: [
                    'Verificar que el cable de alimentaci√≥n est√© bien conectado tanto al computador como al tomacorriente',
                    'Probar con un tomacorriente diferente para descartar problemas el√©ctricos',
                    'Si es un port√°til, verificar que la bater√≠a tenga carga o conectar el cargador',
                    'Revisar el bot√≥n de encendido, asegur√°ndose de mantenerlo presionado por 3-5 segundos',
                    'Desconectar todos los dispositivos USB y perif√©ricos, luego intentar encender',
                    'Si tiene fuente de poder externa, verificar que el LED indicador est√© encendido',
                    'En caso de persistir, puede ser un problema de fuente de poder o placa madre - contactar servicio t√©cnico'
                ]
            },
            'sobrecalentamiento': {
                title: 'üî• Sobrecalentamiento del equipo',
                steps: [
                    'Apagar inmediatamente el equipo y dejarlo enfriar por 30 minutos',
                    'Verificar que las rejillas de ventilaci√≥n no est√©n obstruidas por polvo o objetos',
                    'Limpiar las rejillas con aire comprimido o un pincel suave',
                    'Asegurar que el equipo est√© en una superficie plana y dura, no sobre camas o sof√°s',
                    'Verificar que los ventiladores internos est√©n funcionando (se debe escuchar el ruido)',
                    'Revisar el administrador de tareas para identificar procesos que consuman mucha CPU',
                    'Considerar usar una base refrigerante para port√°tiles',
                    'Si persiste, puede necesitar cambio de pasta t√©rmica - contactar t√©cnico especializado'
                ]
            },
            'ruidos-extra√±os': {
                title: 'üîä Ruidos extra√±os en el equipo',
                steps: [
                    'Identificar el tipo de ruido: clicks, chirridos, zumbidos o golpes',
                    'Si son clicks repetitivos, puede ser el disco duro - hacer respaldo inmediato de datos importantes',
                    'Para zumbidos o ruidos de ventilador, limpiar las aspas con aire comprimido',
                    'Si el ruido viene del disco duro, ejecutar chkdsk para verificar errores',
                    'Revisar que no haya cables sueltos que toquen los ventiladores',
                    'Usar software de diagn√≥stico como CrystalDiskInfo para verificar salud del disco',
                    'Si los ruidos persisten o empeoran, apagar el equipo y contactar servicio t√©cnico',
                    'Considerar reemplazar componentes defectuosos antes de que fallen completamente'
                ]
            },
            'pantalla-azul': {
                title: 'üíô Pantalla azul de la muerte (BSOD)',
                steps: [
                    'Anotar el c√≥digo de error que aparece en la pantalla azul',
                    'Reiniciar el equipo y verificar si el problema se repite',
                    'Iniciar en modo seguro: presionar F8 durante el arranque',
                    'Desinstalar software recientemente instalado que pueda estar causando conflictos',
                    'Actualizar todos los controladores de dispositivos',
                    'Ejecutar sfc /scannow en s√≠mbolo del sistema como administrador',
                    'Verificar la memoria RAM con la herramienta de diagn√≥stico de Windows',
                    'Si persiste, buscar el c√≥digo de error espec√≠fico en l√≠nea para soluciones espec√≠ficas',
                    'Considerar restaurar el sistema a un punto anterior cuando funcionaba correctamente'
                ]
            },
            'lento': {
                title: 'üêå Computador muy lento',
                steps: [
                    'Abrir el Administrador de tareas (Ctrl+Shift+Esc) para identificar procesos que consuman recursos',
                    'Desinstalar programas que no uses desde Panel de Control > Programas',
                    'Ejecutar limpieza de disco para eliminar archivos temporales',
                    'Deshabilitar programas de inicio innecesarios en la configuraci√≥n del sistema',
                    'Ejecutar un an√°lisis completo con tu antivirus',
                    'Verificar que tengas al menos 15% de espacio libre en el disco duro',
                    'Actualizar controladores de dispositivos, especialmente gr√°ficos',
                    'Considerar instalar m√°s RAM si constantemente usas m√°s del 80%',
                    'Desfragmentar el disco duro si usas Windows en HDD (no necesario para SSD)'
                ]
            },
            'programas-no-abren': {
                title: '‚ùå Los programas no abren',
                steps: [
                    'Intentar ejecutar el programa como administrador (click derecho > Ejecutar como administrador)',
                    'Verificar si el problema ocurre con todos los programas o solo algunos espec√≠ficos',
                    'Reiniciar el equipo para limpiar procesos que puedan estar interfiriendo',
                    'Actualizar el programa problem√°tico a la √∫ltima versi√≥n',
                    'Verificar compatibilidad del programa con tu versi√≥n de Windows',
                    'Ejecutar el solucionador de problemas de compatibilidad de Windows',
                    'Desinstalar y reinstalar el programa problem√°tico',
                    'Verificar que no haya software antivirus bloqueando la ejecuci√≥n',
                    'Revisar los registros de eventos de Windows para mensajes de error espec√≠ficos'
                ]
            },
            'virus': {
                title: 'ü¶† Posible infecci√≥n de virus',
                steps: [
                    'No entrar en p√°nico - desconectar internet temporalmente si es necesario',
                    'Ejecutar an√°lisis completo con tu software antivirus actualizado',
                    'Usar Windows Defender o instalar Malwarebytes para segunda opini√≥n',
                    'Iniciar en modo seguro si el sistema est√° muy comprometido',
                    'Cambiar todas las contrase√±as importantes desde otro dispositivo',
                    'Verificar procesos sospechosos en el Administrador de tareas',
                    'Eliminar archivos temporales y limpiar navegadores',
                    'Restaurar sistema a punto anterior si el problema persiste',
                    'Considerar formateo completo si la infecci√≥n es severa'
                ]
            },
            'actualizaciones': {
                title: 'üîÑ Problemas con actualizaciones',
                steps: [
                    'Verificar conexi√≥n a internet estable antes de intentar actualizar',
                    'Liberar espacio en disco - las actualizaciones requieren espacio temporal',
                    'Ejecutar el solucionador de problemas de Windows Update',
                    'Reiniciar el servicio de Windows Update desde servicios.msc',
                    'Limpiar la carpeta de distribuci√≥n de software: C:\\Windows\\SoftwareDistribution',
                    'Intentar actualizar en modo seguro si las actualizaciones fallan repetidamente',
                    'Descargar actualizaciones manualmente desde el cat√°logo de Microsoft',
                    'Verificar que la fecha y hora del sistema sean correctas',
                    'Si nada funciona, considerar actualizaci√≥n limpia de Windows'
                ]
            },
            'sin-internet': {
                title: 'üåê Sin conexi√≥n a Internet',
                steps: [
                    'Verificar que otros dispositivos se conecten al mismo router',
                    'Reiniciar el router desconect√°ndolo por 30 segundos',
                    'Verificar que los cables de red est√©n bien conectados',
                    'Ejecutar el solucionador de problemas de red de Windows',
                    'Restablecer configuraci√≥n de red: netsh winsock reset en CMD',
                    'Actualizar controladores de la tarjeta de red',
                    'Verificar configuraci√≥n de DNS - probar con 8.8.8.8 y 8.8.4.4',
                    'Deshabilitar temporalmente firewall y antivirus para probar',
                    'Contactar proveedor de internet si el problema persiste'
                ]
            },
            'wifi-lento': {
                title: 'üì∂ WiFi lento o intermitente',
                steps: [
                    'Acercarse al router para verificar si mejora la se√±al',
                    'Verificar cu√°ntos dispositivos est√°n conectados a la red',
                    'Cambiar canal WiFi en configuraci√≥n del router (usar 1, 6 u 11 para 2.4GHz)',
                    'Actualizar controladores de la tarjeta WiFi',
                    'Olvidar y reconectar a la red WiFi',
                    'Verificar si hay interferencias de otros dispositivos electr√≥nicos',
                    'Probar conexi√≥n en banda de 5GHz si est√° disponible',
                    'Reiniciar adaptador de red desde Administrador de dispositivos',
                    'Considerar extender cobertura WiFi si la distancia es el problema'
                ]
            },
            'bluetooth': {
                title: 'üì± Problemas con Bluetooth',
                steps: [
                    'Verificar que Bluetooth est√© habilitado en configuraci√≥n de Windows',
                    'Asegurar que el dispositivo a conectar est√© en modo de emparejamiento',
                    'Eliminar dispositivo de la lista y volver a emparejarlo',
                    'Actualizar controladores Bluetooth desde Administrador de dispositivos',
                    'Reiniciar el servicio de Bluetooth en servicios.msc',
                    'Verificar que no haya interferencia de dispositivos de 2.4GHz cercanos',
                    'Probar con otro dispositivo Bluetooth para descartar problemas de hardware',
                    'Ejecutar solucionador de problemas de Bluetooth de Windows',
                    'Si persiste, puede ser problema de hardware - contactar soporte t√©cnico'
                ]
            },
            'teclado-mouse': {
                title: '‚å®Ô∏è Teclado o mouse no funcionan',
                steps: [
                    'Verificar conexiones f√≠sicas - reconectar cables USB',
                    'Probar en otros puertos USB para descartar puerto defectuoso',
                    'Si son inal√°mbricos, verificar carga de pilas o bater√≠a',
                    'Reiniciar el equipo para recargar controladores',
                    'Verificar en Administrador de dispositivos si aparecen con errores',
                    'Probar con otro teclado/mouse para identificar si es problema de hardware',
                    'Desinstalar y reinstalar controladores del dispositivo',
                    'Verificar configuraci√≥n de energ√≠a USB - deshabilitar suspensi√≥n selectiva',
                    'Si es problema de hardware, considerar reemplazo del dispositivo'
                ]
            },
            'impresora': {
                title: 'üñ®Ô∏è Problemas con impresora',
                steps: [
                    'Verificar que la impresora est√© encendida y conectada correctamente',
                    'Comprobar niveles de tinta o t√≥ner',
                    'Verificar que no haya atascos de papel en la bandeja',
                    'Reinstalar controladores de la impresora',
                    'Configurar como impresora predeterminada en Windows',
                    'Ejecutar solucionador de problemas de impresora de Windows',
                    'Limpiar cabezales de impresi√≥n desde software de la impresora',
                    'Verificar cola de impresi√≥n y cancelar trabajos pendientes',
                    'Probar imprimir p√°gina de prueba desde propiedades de impresora'
                ]
            },
            'audio': {
                title: 'üîä Sin audio o problemas de sonido',
                steps: [
                    'Verificar que el volumen no est√© silenciado o muy bajo',
                    'Comprobar conexiones de altavoces o auriculares',
                    'Actualizar controladores de audio desde Administrador de dispositivos',
                    'Verificar que el dispositivo de audio correcto est√© seleccionado',
                    'Ejecutar solucionador de problemas de audio de Windows',
                    'Reiniciar servicio de audio de Windows',
                    'Probar con diferentes auriculares o altavoces',
                    'Verificar configuraci√≥n de audio en aplicaciones espec√≠ficas',
                    'Restaurar controladores de audio si el problema comenz√≥ recientemente'
                ]
            }
        };

        // Base de conocimientos mejorada para el asistente
        const knowledgeBase = {
            // Patrones de problemas comunes
            patterns: {
                'lento|rendimiento|velocidad|demora': 'performance',
                'no enciende|no prende|no arranca|dead': 'power',
                'internet|wifi|red|conexi√≥n|conectividad': 'network',
                'virus|malware|infectado|sospechoso': 'security',
                'pantalla azul|bsod|error azul': 'bsod',
                'caliente|temperatura|ventilador|sobrecalentamiento': 'overheating',
                'ruido|sonido extra√±o|clicks|chirridos': 'hardware_noise',
                'actualizaci√≥n|update|windows update': 'updates',
                'programas|aplicaciones|software no abre': 'software_issues',
                'teclado|mouse|rat√≥n|perif√©rico': 'peripherals',
                'audio|sonido|altavoces|auriculares': 'audio',
                'impresora|imprimir|print': 'printer',
                'bluetooth|emparejamiento': 'bluetooth'
            },

            // Respuestas contextuales avanzadas
            responses: {
                performance: {
                    analysis: "Veo que tienes problemas de rendimiento. Voy a ayudarte a diagnosticar y optimizar tu sistema.",
                    questions: [
                        "¬øCu√°ndo comenz√≥ a ir lento tu computador?",
                        "¬øOcurre siempre o solo con programas espec√≠ficos?",
                        "¬øHas instalado software nuevo recientemente?"
                    ],
                    solutions: [
                        "üîç **Diagn√≥stico inmediato**: Abre el Administrador de tareas (Ctrl+Shift+Esc) y revisa qu√© procesos est√°n consumiendo m√°s CPU y memoria.",
                        "üßπ **Limpieza r√°pida**: Ejecuta Liberador de espacio en disco y elimina archivos temporales.",
                        "‚ö° **Optimizaci√≥n de inicio**: Desactiva programas innecesarios que se ejecutan al iniciar Windows.",
                        "üîÑ **Mantenimiento**: Ejecuta `sfc /scannow` en CMD como administrador para reparar archivos del sistema."
                    ]
                },
                power: {
                    analysis: "Problema cr√≠tico de alimentaci√≥n. Te gu√≠o paso a paso para diagnosticar si es hardware o configuraci√≥n.",
                    questions: [
                        "¬øHay alguna luz o LED encendido en el equipo?",
                        "¬øEs un computador de escritorio o port√°til?",
                        "¬øOcurri√≥ despu√©s de alg√∫n evento espec√≠fico?"
                    ],
                    solutions: [
                        "üîå **Verificaci√≥n b√°sica**: Aseg√∫rate de que todos los cables est√©n firmemente conectados.",
                        "‚ö° **Test de alimentaci√≥n**: Prueba con otro tomacorriente conocido que funcione.",
                        "üîã **Para port√°tiles**: Intenta sin bater√≠a, solo con cargador conectado.",
                        "‚è∞ **Reset CMOS**: Si nada funciona, puede necesitar reset de BIOS."
                    ]
                },
                network: {
                    analysis: "Problemas de conectividad pueden tener varias causas. Vamos a identificar si es tu equipo, router o ISP.",
                    questions: [
                        "¬øOtros dispositivos se conectan bien a la misma red?",
                        "¬øEs problema de WiFi o tambi√©n cable de red?",
                        "¬øCu√°ndo funcion√≥ por √∫ltima vez?"
                    ],
                    solutions: [
                        "üåê **Test b√°sico**: Ejecuta `ping google.com` en CMD para verificar conectividad.",
                        "üîÑ **Reset de red**: `netsh winsock reset` y `ipconfig /flushdns` en CMD como administrador.",
                        "üì° **Diagn√≥stico WiFi**: Olvida la red y recon√©ctate, o prueba conectarte a tu hotspot m√≥vil.",
                        "üõ†Ô∏è **Drivers**: Actualiza controladores de red desde Administrador de dispositivos."
                    ]
                },
                security: {
                    analysis: "Posible compromiso de seguridad. Actuemos r√°pido pero sin p√°nico para limpiar el sistema.",
                    questions: [
                        "¬øQu√© comportamientos extra√±os has notado?",
                        "¬øHas descargado algo sospechoso recientemente?",
                        "¬øTu antivirus est√° actualizado y funcionando?"
                    ],
                    solutions: [
                        "üõ°Ô∏è **An√°lisis inmediato**: Ejecuta an√°lisis completo con Windows Defender o tu antivirus.",
                        "üîç **Segunda opini√≥n**: Descarga y ejecuta Malwarebytes Anti-Malware.",
                        "üîí **Modo seguro**: Reinicia en modo seguro si el sistema est√° muy comprometido.",
                        "üîë **Cambio de contrase√±as**: Cambia contrase√±as importantes desde otro dispositivo limpio."
                    ]
                },
                bsod: {
                    analysis: "La pantalla azul indica un error cr√≠tico del sistema. El c√≥digo espec√≠fico nos dar√° pistas importantes.",
                    questions: [
                        "¬øPudiste anotar el c√≥digo de error (ej: 0x0000007B)?",
                        "¬øOcurre en situaciones espec√≠ficas o aleatoriamente?",
                        "¬øInstalaste hardware o software nuevo recientemente?"
                    ],
                    solutions: [
                        "üìù **C√≥digo de error**: Anota el c√≥digo STOP espec√≠fico para diagn√≥stico preciso.",
                        "üîß **Modo seguro**: Inicia en modo seguro presionando F8 durante el arranque.",
                        "üîÑ **√öltima configuraci√≥n**: Usa '√öltima configuraci√≥n buena conocida' en opciones avanzadas.",
                        "üíæ **Verificaci√≥n RAM**: Ejecuta diagn√≥stico de memoria de Windows."
                    ]
                }
            }
        };

        // Sistema de respuestas inteligentes mejorado
        class TechAssistant {
            constructor() {
                this.context = '';
                this.userPreferences = {};
                this.conversationHistory = [];
            }

            analyzeMessage(message) {
                const lowerMessage = message.toLowerCase();
                
                // Detectar patrones en el mensaje
                for (const [pattern, category] of Object.entries(knowledgeBase.patterns)) {
                    const regex = new RegExp(pattern, 'i');
                    if (regex.test(lowerMessage)) {
                        return category;
                    }
                }
                
                return 'general';
            }

            generateResponse(message, category) {
                const responses = knowledgeBase.responses[category];
                
                if (responses) {
                    let response = responses.analysis + "\n\n";
                    
                    // Agregar preguntas de diagn√≥stico
                    if (responses.questions) {
                        response += "**Preguntas de diagn√≥stico:**\n";
                        responses.questions.forEach((q, i) => {
                            response += `${i + 1}. ${q}\n`;
                        });
                        response += "\n";
                    }
                    
                    // Agregar soluciones paso a paso
                    if (responses.solutions) {
                        response += "**Soluciones paso a paso:**\n\n";
                        responses.solutions.forEach(solution => {
                            response += `${solution}\n\n`;
                        });
                    }
                    
                    // Agregar seguimiento
                    response += "üí¨ **¬øNecesitas ayuda con alguno de estos pasos espec√≠ficos?** Solo dime cu√°l y te gu√≠o en detalle.";
                    
                    return response;
                }
                
                return this.getGeneralResponse(message);
            }

            getGeneralResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Respuestas generales mejoradas
                if (lowerMessage.includes('hola') || lowerMessage.includes('hi')) {
                    return "¬°Hola! üëã Soy tu asistente t√©cnico especializado. Estoy aqu√≠ para ayudarte a resolver cualquier problema con tu computador. ¬øQu√© dificultad t√©cnica est√°s experimentando?";
                }
                
                if (lowerMessage.includes('gracias') || lowerMessage.includes('thank')) {
                    return "¬°De nada! üòä Me alegra poder ayudarte. Si tienes m√°s problemas t√©cnicos o preguntas sobre el proceso, no dudes en consultarme. ¬øHay algo m√°s en lo que pueda asistirte?";
                }
                
                if (lowerMessage.includes('ayuda') || lowerMessage.includes('help')) {
                    return `Claro, puedo ayudarte con una amplia gama de problemas t√©cnicos:

üîß **Hardware**: Problemas de encendido, sobrecalentamiento, ruidos extra√±os
üíª **Software**: Rendimiento lento, aplicaciones que no responden, errores del sistema  
üåê **Conectividad**: Internet, WiFi, Bluetooth, red
üõ°Ô∏è **Seguridad**: Virus, malware, actualizaciones de seguridad
üñ±Ô∏è **Perif√©ricos**: Teclado, mouse, impresora, audio

Solo describe tu problema con el mayor detalle posible y te proporcionar√© una soluci√≥n paso a paso. ¬øQu√© problema espec√≠fico est√°s experimentando?`;
                }
                
                // Respuesta por defecto mejorada
                return `Entiendo que tienes una consulta t√©cnica. Para poder ayudarte de la mejor manera, me gustar√≠a conocer m√°s detalles:

üîç **¬øPuedes describir espec√≠ficamente qu√© est√° ocurriendo?**
üìÖ **¬øCu√°ndo comenz√≥ el problema?**
üíª **¬øQu√© tipo de equipo tienes? (Windows, Mac, marca/modelo)**
‚ö†Ô∏è **¬øAparece alg√∫n mensaje de error espec√≠fico?**

Mientras tanto, puedes revisar las **categor√≠as de problemas** en el panel izquierdo o usar las **acciones r√°pidas** aqu√≠ abajo para obtener ayuda inmediata sobre temas comunes.

¬°Estoy aqu√≠ para resolver tu problema t√©cnico paso a paso! üöÄ`;
            }
        }

        // Instancia del asistente
        const assistant = new TechAssistant();

        // Funciones principales mejoradas
        function addMessage(message, isUser = false, showActions = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
            
            // Procesar markdown b√°sico para respuestas del asistente
            if (!isUser) {
                message = processMarkdown(message);
                messageDiv.innerHTML = message;
            } else {
                messageDiv.textContent = message;
            }
            
            // Agregar timestamp
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = time;
            messageDiv.appendChild(timeDiv);
            
            // Agregar acciones para mensajes del asistente
            if (!isUser && showActions) {
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'message-actions';
                actionsDiv.innerHTML = `
                    <button class="action-btn" onclick="rateMessage(this, 'good')">üëç</button>
                    <button class="action-btn" onclick="rateMessage(this, 'bad')">üëé</button>
                    <button class="action-btn" onclick="copyMessage(this)">üìã</button>
                `;
                messageDiv.appendChild(actionsDiv);
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function processMarkdown(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
        }

        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-animation';
            typingDiv.id = 'typing';
            typingDiv.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Actualizar estado
            document.getElementById('assistantStatus').style.display = 'none';
            document.getElementById('typingIndicator').style.display = 'block';
        }

        function hideTypingIndicator() {
            const typing = document.getElementById('typing');
            if (typing) {
                typing.remove();
            }
            
            // Restaurar estado
            document.getElementById('assistantStatus').style.display = 'block';
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            const sendBtn = document.getElementById('sendBtn');
            
            if (!message || isTyping) return;
            
            // Agregar mensaje del usuario
            addMessage(message, true);
            input.value = '';
            
            // Deshabilitar input mientras procesa
            input.disabled = true;
            sendBtn.disabled = true;
            isTyping = true;
            
            // Mostrar indicador de escritura
            showTypingIndicator();
            
            // Simular tiempo de procesamiento realista
            setTimeout(() => {
                hideTypingIndicator();
                
                // Analizar mensaje y generar respuesta
                const category = assistant.analyzeMessage(message);
                const response = assistant.generateResponse(message, category);
                
                // Agregar respuesta del asistente
                addMessage(response, false, true);
                
                // Restaurar input
                input.disabled = false;
                sendBtn.disabled = false;
                isTyping = false;
                input.focus();
                
            }, 1500 + Math.random() * 1000); // Tiempo variable para simular procesamiento
        }

        function sendSuggestion(suggestion) {
            document.getElementById('userInput').value = suggestion;
            sendMessage();
        }

        function quickAction(action) {
            const responses = {
                'diagnostico': `üîç **Diagn√≥stico Autom√°tico del Sistema**

Vamos a revisar el estado general de tu computador. Sigue estos pasos:

**1. Verificaci√≥n de Recursos:**
‚Ä¢ Abre Administrador de tareas (Ctrl+Shift+Esc)
‚Ä¢ Revisa uso de CPU, Memoria y Disco
‚Ä¢ Identifica procesos que consuman muchos recursos

**2. Estado del Sistema:**
‚Ä¢ Presiona Win+R, escribe "msinfo32"
‚Ä¢ Revisa informaci√≥n general del sistema
‚Ä¢ Anota cualquier advertencia o error

**3. Salud del Disco:**
‚Ä¢ Abre CMD como administrador
‚Ä¢ Ejecuta: \`chkdsk C: /f /r\` (programa para pr√≥ximo reinicio)
‚Ä¢ Para SSD, usa: \`sfc /scannow\`

**4. Temperatura y Hardware:**
‚Ä¢ Verifica que ventiladores funcionen
‚Ä¢ Escucha ruidos extra√±os
‚Ä¢ Siente si hay sobrecalentamiento

**üìä ¬øQu√© encontraste en estos diagn√≥sticos?** Comparte los resultados y te ayudar√© a interpretarlos.`,

                'mantenimiento': `üßπ **Gu√≠a de Mantenimiento Preventivo**

**Mantenimiento Semanal:**
‚Ä¢ Reinicia el equipo completamente al menos una vez
‚Ä¢ Ejecuta an√°lisis antivirus completo
‚Ä¢ Limpia archivos temporales con Liberador de espacio

**Mantenimiento Mensual:**
‚Ä¢ Actualiza controladores importantes
‚Ä¢ Verifica y instala actualizaciones de Windows
‚Ä¢ Limpia f√≠sicamente teclado y pantalla
‚Ä¢ Revisa programas instalados y desinstala los innecesarios

**Mantenimiento Trimestral:**
‚Ä¢ Limpieza f√≠sica interna con aire comprimido
‚Ä¢ Desfragmentaci√≥n de disco (solo HDD)
‚Ä¢ Backup completo de archivos importantes
‚Ä¢ Verificaci√≥n de temperatura del sistema

**Mantenimiento Anual:**
‚Ä¢ Reemplazo de pasta t√©rmica (si es necesario)
‚Ä¢ Verificaci√≥n completa de hardware
‚Ä¢ Formateo y reinstalaci√≥n limpia (opcional)

**üí° ¬øTe gustar√≠a que te gu√≠e en alguno de estos procesos espec√≠ficos?**`,

                'optimizacion': `‚ö° **Optimizaci√≥n Avanzada del Rendimiento**

**Optimizaci√≥n Inmediata:**
‚Ä¢ Deshabilita efectos visuales: Panel de Control > Sistema > Configuraci√≥n avanzada > Rendimiento
‚Ä¢ Configura servicios: \`services.msc\` - deshabilita servicios innecesarios
‚Ä¢ Limpia registro con herramientas confiables

**Gesti√≥n de Memoria:**
‚Ä¢ Cierra programas que no uses activamente
‚Ä¢ Ajusta memoria virtual: 1.5x tu RAM f√≠sica
‚Ä¢ Considera actualizar RAM si usas constantemente >80%

**Optimizaci√≥n de Almacenamiento:**
‚Ä¢ Mant√©n 15-20% de espacio libre siempre
‚Ä¢ Usa SSD como disco principal si es posible
‚Ä¢ Configura ubicaciones de archivos temporales

**Configuraci√≥n de Energ√≠a:**
‚Ä¢ Usa plan "Alto rendimiento" cuando sea necesario
‚Ä¢ Ajusta configuraci√≥n de suspensi√≥n de USB
‚Ä¢ Verifica que la CPU no est√© limitada por temperatura

**üöÄ ¬øEn qu√© √°rea espec√≠fica quieres enfocarte primero?**`,

                'seguridad': `üõ°Ô∏è **Verificaci√≥n Completa de Seguridad**

**Protecci√≥n Antimalware:**
‚Ä¢ Verifica que Windows Defender est√© activo y actualizado
‚Ä¢ Ejecuta an√°lisis completo del sistema
‚Ä¢ Instala Malwarebytes para segunda opini√≥n

**Configuraci√≥n de Firewall:**
‚Ä¢ Verifica que Firewall de Windows est√© habilitado
‚Ä¢ Revisa aplicaciones permitidas
‚Ä¢ Configura reglas para programas espec√≠ficos

**Actualizaciones de Seguridad:**
‚Ä¢ Instala todas las actualizaciones pendientes de Windows
‚Ä¢ Actualiza navegadores y plugins (Java, Flash, etc.)
‚Ä¢ Mant√©n software importante siempre actualizado

**Configuraci√≥n de Navegadores:**
‚Ä¢ Habilita navegaci√≥n segura
‚Ä¢ Configura bloqueador de pop-ups
‚Ä¢ Revisa extensiones instaladas y elimina las sospechosas

**Mejores Pr√°cticas:**
‚Ä¢ Usa contrase√±as √∫nicas y seguras
‚Ä¢ Habilita autenticaci√≥n de dos factores donde sea posible
‚Ä¢ No descargues software de sitios no confiables
‚Ä¢ Mant√©n backups regulares de datos importantes

**üîí ¬øHas detectado alguna actividad sospechosa espec√≠fica?**`
            };

            const response = responses[action];
            if (response) {
                // Simular que el usuario hizo la pregunta
                const actionTitles = {
                    'diagnostico': 'Ejecutar diagn√≥stico autom√°tico',
                    'mantenimiento': 'Gu√≠a de mantenimiento preventivo', 
                    'optimizacion': 'Optimizar rendimiento del sistema',
                    'seguridad': 'Verificar seguridad del equipo'
                };
                
                addMessage(actionTitles[action], true);
                
                setTimeout(() => {
                    showTypingIndicator();
                    setTimeout(() => {
                        hideTypingIndicator();
                        addMessage(response, false, true);
                    }, 1200);
                }, 500);
            }
        }

        function rateMessage(btn, rating) {
            const message = btn.closest('.message');
            message.style.opacity = '0.7';
            
            if (rating === 'good') {
                btn.innerHTML = 'üëç ¬°√ötil!';
                btn.style.color = '#27ae60';
            } else {
                btn.innerHTML = 'üëé Enviado';
                btn.style.color = '#e74c3c';
            }
            
            btn.disabled = true;
            
            // Simular env√≠o de feedback
            setTimeout(() => {
                const feedback = document.createElement('div');
                feedback.style.cssText = 'font-size: 12px; color: #7f8c8d; margin-top: 5px;';
                feedback.textContent = rating === 'good' ? 
                    'Gracias por tu feedback positivo üòä' : 
                    'Gracias por tu feedback. Trabajaremos para mejorar üîß';
                message.appendChild(feedback);
            }, 500);
        }

        function copyMessage(btn) {
            const message = btn.closest('.message');
            const text = message.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                btn.innerHTML = '‚úÖ Copiado';
                btn.style.color = '#27ae60';
                setTimeout(() => {
                    btn.innerHTML = 'üìã';
                    btn.style.color = '#7f8c8d';
                }, 2000);
            });
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Funciones del sistema de categor√≠as (mantenidas del original)
        function toggleCategory(categoryId) {
            const content = document.getElementById(categoryId);
            const header = content.previousElementSibling;
            const arrow = header.querySelector('span:last-child');
            
            // Cerrar otras categor√≠as
            document.querySelectorAll('.category-content').forEach(cat => {
                if (cat.id !== categoryId) {
                    cat.classList.remove('active');
                    cat.previousElementSibling.querySelector('span:last-child').innerHTML = '‚ñº';
                }
            });
            
            // Toggle categor√≠a actual
            content.classList.toggle('active');
            arrow.innerHTML = content.classList.contains('active') ? '‚ñ≤' : '‚ñº';
        }

        function showSolution(problemId) {
            const solution = solutions[problemId];
            if (!solution) return;
            
            const modal = document.getElementById('solutionModal');
            const details = document.getElementById('solutionDetails');
            
            let stepsHtml = '<ul class="solution-steps">';
            solution.steps.forEach(step => {
                stepsHtml += `<li>${step}</li>`;
            });
            stepsHtml += '</ul>';
            
            details.innerHTML = `
                <h2>${solution.title}</h2>
                <p style="margin-bottom: 20px; color: #7f8c8d;">Sigue estos pasos en orden para resolver el problema:</p>
                ${stepsHtml}
                <div style="margin-top: 20px; padding: 15px; background: #e8f5e8; border-radius: 10px; border-left: 4px solid #27ae60;">
                    <strong>üí° Consejo:</strong> Si despu√©s de seguir todos los pasos el problema persiste, no dudes en contactar a nuestro asistente virtual o un t√©cnico especializado.
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function closeSolution() {
            document.getElementById('solutionModal').style.display = 'none';
        }

        // Event listeners y configuraci√≥n inicial
        document.addEventListener('DOMContentLoaded', function() {
            // Focus autom√°tico en el input
            document.getElementById('userInput').focus();
            
            // Cerrar modal al hacer click fuera
            document.getElementById('solutionModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSolution();
                }
            });
            
            // Mejorar experiencia de chat con auto-resize del input
            const input = document.getElementById('userInput');
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
            
            // Mensajes de bienvenida adicionales
            setTimeout(() => {
                addMessage('üí° **Tip**: Puedes hacer clic en cualquier problema de las categor√≠as para ver soluciones detalladas, o simplemente describir tu problema aqu√≠ y te ayudar√© paso a paso.', false, false);
            }, 3000);
            
            setTimeout(() => {
                addMessage('üöÄ **¬øSab√≠as que?** Puedo ayudarte con diagn√≥sticos en tiempo real, an√°lisis de rendimiento, y resolver problemas complejos. ¬°No dudes en ser espec√≠fico sobre tu problema!', false, false);
            }, 8000);
        });

        // Funciones de utilidad adicionales
        function clearChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = `
                <div class="message assistant">
                    ¬°Hola! üëã Soy TechFix Assistant, tu asistente t√©cnico especializado. Puedo ayudarte con:
                    
                    ‚Ä¢ Diagn√≥stico de problemas de hardware y software
                    ‚Ä¢ Soluci√≥n paso a paso de errores comunes
                    ‚Ä¢ Optimizaci√≥n del rendimiento de tu equipo
                    ‚Ä¢ Consejos de seguridad y mantenimiento
                    
                    ¬øQu√© problema t√©cnico puedo ayudarte a resolver hoy?
                    <div class="suggestions">
                        <span class="suggestion-chip" onclick="sendSuggestion('Mi computador est√° muy lento')">Mi PC est√° lento</span>
                        <span class="suggestion-chip" onclick="sendSuggestion('No tengo internet')">Problemas de internet</span>
                        <span class="suggestion-chip" onclick="sendSuggestion('Mi computador no enciende')">No enciende</span>
                    </div>
                    <div class="message-actions">
                        <button class="action-btn" onclick="rateMessage(this, 'good')">üëç</button>
                        <button class="action-btn" onclick="rateMessage(this, 'bad')">üëé</button>
                        <button class="action-btn" onclick="copyMessage(this)">üìã</button>
                    </div>
                </div>
            `;
            conversationHistory = [];
        }

        // Funci√≥n para exportar conversaci√≥n
        function exportChat() {
            const messages = document.querySelectorAll('.message');
            let chatText = 'Conversaci√≥n con TechFix Assistant\n';
            chatText += '=' + '='.repeat(40) + '\n\n';
            
            messages.forEach(msg => {
                const isUser = msg.classList.contains('user');
                const sender = isUser ? 'Usuario' : 'TechFix Assistant';
                const content = msg.textContent.replace(/üëç.*|üëé.*|üìã.*|Gracias por.*/, '').trim();
                chatText += `${sender}:\n${content}\n\n`;
            });
            
            const blob = new Blob([chatText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `techfix_chat_${new Date().toISOString().slice(0,10)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Funci√≥n para detectar problemas autom√°ticamente
        function autoDetectIssues() {
            // Simulaci√≥n de detecci√≥n autom√°tica de problemas comunes
            const commonIssues = [
                {
                    issue: 'Uso alto de CPU detectado',
                    suggestion: '¬øTu computador est√° funcionando lentamente? Puedo ayudarte a identificar qu√© procesos est√°n consumiendo recursos.'
                },
                {
                    issue: 'Espacio en disco bajo',
                    suggestion: '¬øHas notado que tu computador va m√°s lento? Podr√≠as necesitar liberar espacio en disco.'
                },
                {
                    issue: 'Actualizaciones pendientes',
                    suggestion: '¬øCu√°ndo fue la √∫ltima vez que actualizaste tu sistema? Las actualizaciones mejoran seguridad y rendimiento.'
                }
            ];
            
            // Esta funci√≥n se podr√≠a llamar peri√≥dicamente o en respuesta a eventos espec√≠ficos
            return commonIssues[Math.floor(Math.random() * commonIssues.length)];
        }

        // Sistema de sugerencias inteligentes
        function getSmartSuggestions(message) {
            const lowerMessage = message.toLowerCase();
            const suggestions = [];
            
            if (lowerMessage.includes('lento')) {
                suggestions.push('¬øCu√°nta RAM tienes?', '¬øQu√© programas tienes abiertos?', '¬øCu√°ndo empez√≥ la lentitud?');
            } else if (lowerMessage.includes('internet')) {
                suggestions.push('¬øOtros dispositivos funcionan?', '¬øEs WiFi o cable?', '¬øQu√© velocidad contratas?');
            } else if (lowerMessage.includes('no enciende')) {
                suggestions.push('¬øHay luces encendidas?', '¬øEs port√°til o escritorio?', '¬øProbaste otro enchufe?');
            }
            
            return suggestions;
        }

        // Mejorar accessibility
        function improveAccessibility() {
            // Agregar navegaci√≥n por teclado
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === '/') {
                    document.getElementById('userInput').focus();
                }
                if (e.key === 'Escape') {
                    closeSolution();
                }
            });
            
            // Agregar roles ARIA
            document.getElementById('chatContainer').setAttribute('role', 'log');
            document.getElementById('chatContainer').setAttribute('aria-live', 'polite');
            document.getElementById('userInput').setAttribute('aria-label', 'Escribe tu consulta t√©cnica');
        }

        // Inicializar mejoras de accesibilidad
        improveAccessibility();

        // Sistema de notificaciones para problemas cr√≠ticos
        function showCriticalAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1001;
                background: linear-gradient(45deg, #e74c3c, #c0392b);
                color: white; padding: 15px 20px; border-radius: 10px;
                box-shadow: 0 4px 20px rgba(231, 76, 60, 0.3);
                animation: slideInRight 0.3s ease;
            `;
            alertDiv.innerHTML = `
                <strong>‚ö†Ô∏è Alerta Cr√≠tica</strong><br>
                ${message}
                <button onclick="this.parentElement.remove()" style="
                    background: none; border: none; color: white; 
                    float: right; margin-left: 10px; cursor: pointer;">‚úï</button>
            `;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => alertDiv.remove(), 10000);
        }

        // Funci√≥n para manejar errores de JavaScript
        window.addEventListener('error', function(e) {
            console.error('Error en TechFix Assistant:', e.error);
            // Opcionalmente mostrar mensaje de error al usuario
            addMessage('‚ö†Ô∏è Ocurri√≥ un error t√©cnico. Por favor, recarga la p√°gina si el problema persiste.', false, false);
        });

        console.log('üöÄ TechFix Assistant cargado exitosamente');